#!/bin/sh

    tail -n +2 << '    EOF'

Задание 2 по Unix
=================

Если всё записано в одну строчку, у Вас Windows, откройте этот файл в
[Notepad++](https://notepad-plus-plus.org/).

Внеклассное чтение
------------------

### Задание

Изучите `chmod(1)`. Смените права у того файла, в котором написан этот текст,
так, чтобы он стал исполняемым. Запустите его.
Изучите <https://en.wikipedia.org/wiki/Shebang_(Unix)> и
<https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_07_04>.
Объясните произошедшее.

### Решение

Круто?

Глобы
-----

### Задание

Напишите набор глобов такой, что *каждый* файл в *каждой* поддиректории текущей
директории (не транзитивно), кроме `.` и `..`, подойдёт под ровно один из этих
глобов, а `.` и `..` не подойдут ни под какой.

### Решение

Первое приближение: `*/*`. Не работает, так как не показывает скрытые файлы.

Второе приближение: `*/*`, `*/.??*`. Не работает, так как сюда не подходит
`x/.x`.

Ответ: `*/*`, `*/.??*`, `*/.[!.]`. Для знания последнего надо было залезть в
`glob(7)`.

diff + patch
------------

### Задание

Изучите `diff` и `patch`. Обратите внимание на флаг `-p` у `patch` и `-u` у
`diff`.

Возьмите какую-нибудь директорию `1` с текстовыми файлами. Создайте её копию
`2`. Измените несколько файлов в ней.

1. Примените `diff`, чтобы получить один patch-файл, превращающий директорию `1`
   в директорию `2`.
2. Примените `patch`, чтобы превратить директорию `1` в директорию `2`. Если
   `patch` начал спрашивать, к какому файлу применить изменения, то что-то не
   так.

### Решение

```sh
# перейти в директорию, где находятся 1 и 2_
diff -ur 1 2 > x.patch
patch -p 0 < x.patch
```

Знакомство с командами
----------------------

### Задание

Почитайте man-страницы команд: `chmod` (использовалось выше), `chown`.

1. Сделайте файл, который могут прочитать все пользователи компьютера, кроме
пользователя `bannedUser`.
2. Сделайте файл, который могут читать все пользователи, кроме представителей
группы `bannedUsers`.
3. Сделайте файл, запуск которого даёт рутовый shell.

### Решение

1. `chown bannedUser file1; chmod 044 file1`. Правда, `bannedUser` сможет
   вызвать `chmod` на `file`.
2. `chown root:bannedUsers file2; chmod 404 file2`.
3. `cp /bin/sh /bin/hackedSh; chmod 4755 /bin/hackedSh`, теперь `hackedSh`
   будет работать от рута.

ssh
---

### Задание

Поднимите у себя OpenSSH-сервер.

1. Подключитесь к себе же. Если не знаете свой IP, то `localhost` или
`127.0.0.1` должно сработать.
2. Что будет, если не указывать пользователя?
3. Настройте `.ssh/authorized_keys` так, чтобы `ssh` на своего пользователя
проходил без пароля.
4. (Опционально) Если на компьютере (в виртуалке, в Докере) есть ещё
пользователь, настройте `ssh` без пароля и на нём.

### Решение

1. `ssh localhost`
2. Будет использовано имя пользователя, запускающего команду.
3. После `ssh-keygen` (описано на лекции) сделайте
   `cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys` и
   `chmod 600 ~/.ssh/authorized_keys`.
4. `ssh-copy-id пользователь@адрес -i ~/.ssh/id_rsa.pub`. Эту же команду можно
   применить и для прошлого пункта.

Веб-сервер
----------

### Задание

Установите и настройте себе nginx так, чтобы он работал на порту `8080` и
предоставлял подключающемуся к Вашему компьютеру список файлов в какой-то
(на Ваш выбор) поддиректории в Вашей домашней, но больше ни к чему.

### Решение

1. Путь до выбранной директории должен состоять из директорий, у которых в
   третьей триаде `x`. Иначе сервер не дойдёт.
2. Сама выбранная директория должна быть открыта на чтение.
3. Нужно установить (как это сделать, зависит от системы), запустить и настроить
   `nginx` так, чтобы он знал, что от него хотят. Это следует попробовать
   нагуглить (тема популярная, а навыки гугления полезные), но если совсем туго,
   то вот мой `/etc/nginx/nginx.conf`:

```
worker_processes  1;
events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    server {
        listen       8080;
        server_name  localhost;
        location / {
            autoindex on;
            root   /home/rouanth/Mnt/publicFiles/;
        }
    }
}
```

Напоследок
----------

### Задание

Почитайте про команду `fgrep`. Посчитайте количество пользователей, у которых
shell не является `nologin`.

### Решение

```sh
fgrep -v nologin /etc/passwd | wc -l
```
